{% extends 'base.html' %}
{% block title %}Thông báo - P2P Lending{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <h2 class="text-2xl font-bold mb-6"><i class="fas fa-bell mr-2"></i>Thông báo</h2>
    
    {% if notifications %}
    <div class="space-y-4">
        {% for noti in notifications %}
        <div class="bg-white rounded-lg shadow p-4 {% if not noti.is_read %}border-l-4 border-indigo-500{% endif %}"
             id="noti-{{ noti.id }}">
            <div class="flex justify-between items-start">
                <div>
                    <span class="text-xs px-2 py-1 rounded bg-gray-100">{{ noti.get_notification_type_display }}</span>
                    <h3 class="font-semibold mt-2">{{ noti.title }}</h3>
                    <p class="text-gray-600 mt-1">{{ noti.message }}</p>
                    <p class="text-xs text-gray-400 mt-2">{{ noti.created_at|timesince }} trước</p>
                </div>
                {% if not noti.is_read %}
                <button onclick="markRead({{ noti.id }})" class="text-indigo-600 hover:underline text-sm">
                    Đánh dấu đã đọc
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
        <i class="fas fa-bell-slash text-4xl mb-4"></i>
        <p>Không có thông báo nào</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function markRead(id) {
    fetch(`/notifications/${id}/read/`, {
        method: 'POST',
        headers: {'X-CSRFToken': '{{ csrf_token }}'}
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            document.getElementById('noti-' + id).classList.remove('border-l-4', 'border-indigo-500');
        }
    });
}
</script>
{% endblock %}
